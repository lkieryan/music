@layer layout;

@layer layout {
  :root {
    --element-separation: 12px;
    --toolbar-height: 38px;
    --panel-radius: 10px;
    --sidebar-width: 280px;
    --sidebar-collapsed-width: 56px;
  }

  .app-layout {
    width: 100vw;
    height: 100vh;
    position: relative;
    background: transparent;
    overflow: hidden; /* disable layout scrollbars */
  }

  #navigator-toolbox.header {
    background: transparent;

  }
  /* Single toolbar header should grow to fit both rows */
  .header[data-variant='single'] { height: auto; --urlbar-height: 40px; }

  #appcontent-wrapper {
    position: relative;
    z-index: 1;
    min-width: 1px;
    display: flex;
    flex-direction: column;
    flex: 1; /* fill below header */
  }

  #appcontent-navbar-wrapper {
    backdrop-filter: saturate(120%) blur(8px);
  }

  .navbar-wrapper {
    height: var(--toolbar-height);
    display: block;
  }
  .navbar-container {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    height: var(--toolbar-height);
    gap: var(--element-separation);
    padding-inline: var(--element-separation);
  }
  /* single toolbar inside sidebar */
  .header[data-variant='single'] .sidebar-toolbar-container {
    display: grid;
    grid-auto-rows: min-content;
    row-gap: 6px;
    padding-inline: 6px;
    padding-block: 4px;
  }
  .header[data-variant='single'] .toolbar-row {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    height: var(--toolbar-height);
    gap: var(--element-separation);
  }
  .header[data-variant='single'] .toolbar-row[data-right-side='true'] {
    grid-template-columns: 1fr auto auto;
  }
  .header[data-variant='single'] .toolbar-spacer { min-width: 1px; }
  .header[data-variant='single'] .urlbar-row { height: var(--urlbar-height, 32px); display: flex; align-items: center; width: 100%; }
  .navbar-container[data-right-side='true'] {
    grid-template-columns: 1fr auto auto; /* window buttons on end */
  }
  .window-buttons-slot { display: flex; align-items: center; }
  .actions-slot { display: flex; align-items: center; }
  .urlbar-slot { display: flex; align-items: center; min-width: 0; }
  .urlbar { display: flex; align-items: center; height: var(--urlbar-height, 32px); width: 100%; }
  .urlbar-field { display: grid; grid-template-columns: 24px 1fr; align-items: center; gap: 6px; height: 100%; width: 100%; background: var(--state-hover-bg, rgba(0,0,0,0.06)); border-radius: 8px; padding-inline: 8px; }
  .urlbar-icon { display: inline-flex; align-items: center; justify-content: center; color: currentColor; opacity: .9; }
  .urlbar-icon-svg .nc-icon-wrapper { stroke: currentColor; fill: none; stroke-opacity: 1; }
  .urlbar-icon-svg [stroke='context-fill'] { stroke: currentColor; }
  .urlbar-icon-svg [fill='context-fill'] { fill: currentColor; }
  .urlbar-icon-svg [stroke-opacity='context-fill-opacity'] { stroke-opacity: 1; }
  .urlbar-input {
    height: 100%; width: 100%; border: none; outline: none; border-radius: 8px;
    background: transparent;
    color: var(--text-primary, inherit);
    padding: 0 2px;
  }
  /* simple toolbar buttons styling */
  .toolbar-group { display: inline-flex; align-items: center; gap: 6px; }
  .toolbar-btn { display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 6px; border: none; background: transparent; color: inherit; cursor: pointer; }
  .toolbar-btn:hover { background: var(--state-hover-bg, rgba(0,0,0,0.06)); }
  .toolbar-btn:active { background: var(--state-pressed-bg, rgba(0,0,0,0.12)); }
  .toolbar-icon { width: 16px; height: 16px; }
  .flip-x { transform: scaleX(-1); }

  /* Normalize Firefox icons using context-fill to work on the web */
  .toolbar-icon svg .nc-icon-wrapper { stroke: currentColor; fill: none; stroke-opacity: 1; }
  .toolbar-icon svg [stroke='context-fill'] { stroke: currentColor; }
  .toolbar-icon svg [fill='context-fill'] { fill: currentColor; }
  .toolbar-icon svg [stroke-opacity='context-fill-opacity'] { stroke-opacity: 1; }

  /* content-shell holds Header and appcontent-wrapper as siblings */
  .content-shell {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  /* default: header on top of content */
  .content-shell > .header { order: 0; }
  .content-shell > #appcontent-wrapper { order: 1; }

  /* single toolbar: header remains independent above content; content area has no internal topbar */

  /* compact mode: sidebar collapses width; topbar stays inside content area */
  .content-shell[data-compact-mode='true'] .sidebar-box { width: var(--sidebar-collapsed-width); }
  /* Ensure essentials grid recalculates on compact: default to 2 cols when collapsed */
  .content-shell[data-compact-mode='true'] .sidebar-box .essentials-list { grid-template-columns: repeat(2, minmax(40px, 1fr)); }
  .content-shell[data-compact-mode='false'] .sidebar-box { width: var(--sidebar-width); }

  .tabbox-wrapper {
    display: flex;
    flex-direction: row;
    flex: 1;
    min-height: 0; /* enable children to size/scroll */
  }

  .sidebar-box {
    width: var(--sidebar-width);
    background: transparent;
    backdrop-filter: saturate(120%) blur(8px);
    height: 100%;
    overflow-y: auto;          /* allow sidebar to scroll vertically */
    overflow-x: hidden;        /* prevent horizontal scrollbar */
    overscroll-behavior: contain;
    position: relative; /* for edge drag affordance */
  }

  /* Remove global ew-resize cursor; handled per-edge in component */

  .sidebar-header {
    position: sticky;
    top: 0;
    z-index: 2;
    background: transparent;
    /* reserve toolbar height */
    min-height: var(--toolbar-height);
    /* width: calc(var(--sidebar-width) - 16px); */
    align-items: stretch;
  }

  /* Essentials (layout-only) */
  .essentials-section { padding: 8px 6px 6px; display: flex; flex-direction: column; gap: 8px; }
  .essentials-header { position: sticky; top: 0; z-index: 1; padding: 6px 4px; font-size: 12px; font-weight: 600; opacity: .8; backdrop-filter: saturate(120%) blur(4px); }
  /* Essentials grid: max 4 items per row; responsive to sidebar width via data-essentials-cols */
  .essentials-list { display: grid; gap: 6px; grid-template-columns: repeat(4, minmax(0, 1fr)); }
  .sidebar-box[data-essentials-cols='4'] .essentials-list { grid-template-columns: repeat(4, minmax(56px, 1fr)); }
  .sidebar-box[data-essentials-cols='3'] .essentials-list { grid-template-columns: repeat(3, minmax(56px, 1fr)); }
  .sidebar-box[data-essentials-cols='2'] .essentials-list { grid-template-columns: repeat(2, minmax(56px, 1fr)); }
  .essential-item {
    display: grid;
    place-items: center;
    border-radius: 8px;
    min-width: 38px;
    min-height: 48px;
    cursor: pointer;
    user-select: none;
    background: var(--state-hover-bg, var(--menu-hover-bgcolor));
    border: 1px solid transparent;
    transition: background .12s ease, border-color .12s ease;
  }
  .essential-item:hover {
    background: var(--state-selected-bg, var(--menu-selected-bgcolor));
  }
  /* selected state: allow multiple conventions */
  .essential-item[aria-selected='true'],
  .essential-item[data-active='true'],
  .essential-item.is-selected {
    border-color: var(--color-border, color-mix(in srgb, currentColor 20%, transparent));
  }
  .essential-item:active { transform: scale(0.98); }
  .essential-icon { width: 18px; height: 18px; background-size: cover; background-position: center; border-radius: 6px; }
  .essential-label { display: none; }

  /* Compact: tighter density */
  .content-shell[data-compact-mode='true'] .essentials-section { padding: 4px 4px 3px; gap: 6px; }
  .content-shell[data-compact-mode='true'] .essentials-header { padding: 4px 2px; font-size: 11px; }
  .content-shell[data-compact-mode='true'] .essentials-list { gap: 4px; }
  .content-shell[data-compact-mode='true'] .essential-item {
    padding: 6px;
    min-width: 40px;
    min-height: 40px;
    border-radius: 6px;
    cursor: pointer;
  }
  .content-shell[data-compact-mode='true'] .essential-icon { width: 16px; height: 16px; border-radius: 4px; }
  .content-shell[data-compact-mode='true'] .sidebar-box[data-essentials-cols='4'] .essentials-list { grid-template-columns: repeat(4, minmax(40px, 1fr)); }
  .content-shell[data-compact-mode='true'] .sidebar-box[data-essentials-cols='3'] .essentials-list { grid-template-columns: repeat(3, minmax(40px, 1fr)); }
  .content-shell[data-compact-mode='true'] .sidebar-box[data-essentials-cols='2'] .essentials-list { grid-template-columns: repeat(2, minmax(40px, 1fr)); }

  .sidebar-splitter {
    width: var(--element-separation);
    height: 100%;
  }

  .tabbox {
    flex: 1;
    min-width: 0;
  }
  .tabbox > .content-area {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0;
  }
  .player-shell {
    width: 100%;
    background: rgba(0,0,0,0.2);
    backdrop-filter: saturate(120%) blur(6px);
    border-top: 1px solid rgba(0,0,0,0.08);
  }
  /* Ensure global-bottom player stays at the very bottom and content does not overlap */
  .player-shell.global-bottom {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
  }
  /* When global-bottom player is visible, reserve space so content doesn't hide behind it */
  .content-shell[data-player-placement='global-bottom'] #appcontent-wrapper {
    padding-bottom: var(--player-height, 0px);
  }
  .player-shell.content-bottom {
    position: sticky;
    bottom: 0;
    z-index: 2;
  }
  .player-shell.sidebar {
    position: sticky;
    bottom: 0;
    z-index: 2;
    width: auto;
  }

  .tabpanels {
    position: relative;
    min-height: 0;
    flex: 1; /* take remaining space under content topbar */
  }

  .app-content-panel {
    padding: 10px;
    position:pxelative;
    width: 100%;
    height: 100%;
    border-radius: var(--panel-radius);
    box-shadow: none;
    overflow: auto;            /* allow routed pages to scroll */
    -webkit-overflow-scrolling: touch;
    background: transparent;
  }

  .external-webview {
    width: 100%;
    height: 100%;
    border: 0;
  }

  /* right side sidebar removes left outer margin */
  .app-layout[data-right-side='false'] .tabbox-wrapper {
    margin-left: 0;
  }
  .app-layout[data-right-side='true'] .tabbox-wrapper {
    margin-right: 0;
  }

  /* Global background layers */
  .app-layout::before,
  .app-layout::after {
    content: '';
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
  }

  /* gradient/background main layer */
  .app-layout::before {
    /* Prefer generic variables; fallback to existing * variables if present */
    background: var(
      --app-background-gradient,
      var(--main-browser-background, linear-gradient(135deg, #667eea 0%, #764ba2 100%))
    );
    opacity: var(--app-background-opacity, var(--background-opacity, 1));
    transition: opacity 0.3s ease;
  }

  /* grain overlay (shown when attribute or data-flag is set) */
  .app-layout::after {
    background: var(--app-background-gradient-old, var(--main-browser-background-old, linear-gradient(135deg, #667eea 0%, #764ba2 100%)));
    opacity: calc(1 - var(--app-background-opacity, var(--background-opacity, 1)));
    transition: opacity 0.3s ease;
  }
}

